# PRD: Migrate test-contractor from Jest to Vitest Naming

## Introduction

The `packages/test-contractor` package is a contract-based testing framework that already uses Vitest as its test runner (v4.0.17). However, internal code still contains Jest-named classes, utilities, and references (e.g., `MockJestStrategy`, `JestSpyService`, `index-jest-setup.ts`). This migration will rename all internal Jest references to Vitest naming conventions and ensure no Jest dependencies remain, providing a consistent and clear codebase.

## Goals

- Rename all Jest-named classes, files, and utilities to Vitest naming
- Remove any remaining Jest dependencies from package.json
- Update all imports and references across the package
- Ensure all tests pass after migration
- Maintain backward compatibility where possible through type aliases (if needed)

## User Stories

### US-001: Audit Jest references and dependencies
**Description:** As a developer, I need to identify all Jest-related code and dependencies so that I can plan the migration accurately.

**Acceptance Criteria:**
- [ ] List all files with "jest" in the filename
- [ ] List all classes/types with "Jest" in the name
- [ ] Check package.json for any Jest dependencies
- [ ] Document all findings for subsequent stories
- [ ] Typecheck passes

---

### US-002: Rename setup file from jest-setup to vitest-setup
**Description:** As a developer, I want the test setup file to use Vitest naming so that it reflects the actual test framework being used.

**Acceptance Criteria:**
- [ ] Rename `src/__tests__/index-jest-setup.ts` to `src/__tests__/index-vitest-setup.ts`
- [ ] Update all references in vitest config files
- [ ] Typecheck passes
- [ ] Tests pass

---

### US-003: Rename MockJestStrategy to MockVitestStrategy
**Description:** As a developer, I want the mock strategy class to use Vitest naming for consistency.

**Acceptance Criteria:**
- [ ] Rename `mock-jest-strategy.ts` to `mock-vitest-strategy.ts`
- [ ] Rename class `MockJestStrategy` to `MockVitestStrategy`
- [ ] Rename corresponding test file `mock-jest-strategy.test.ts` to `mock-vitest-strategy.test.ts`
- [ ] Rename contract file `mock-jest-strategy.contract.ts` to `mock-vitest-strategy.contract.ts`
- [ ] Update all imports and references
- [ ] Typecheck passes
- [ ] Tests pass

---

### US-004: Rename MockJestEmptyStrategy to MockVitestEmptyStrategy
**Description:** As a developer, I want the empty mock strategy class to use Vitest naming for consistency.

**Acceptance Criteria:**
- [ ] Rename `mock-jest-empty-strategy.ts` to `mock-vitest-empty-strategy.ts`
- [ ] Rename class `MockJestEmptyStrategy` to `MockVitestEmptyStrategy`
- [ ] Rename corresponding test file `mock-jest-empty-strategy.test.ts` to `mock-vitest-empty-strategy.test.ts`
- [ ] Rename contract file `mock-jest-empty-strategy.contract.ts` to `mock-vitest-empty-strategy.contract.ts`
- [ ] Update all imports and references
- [ ] Typecheck passes
- [ ] Tests pass

---

### US-005: Rename JestSpyService and related classes
**Description:** As a developer, I want the spy service and strategies to use Vitest naming for consistency.

**Acceptance Criteria:**
- [ ] Rename `jest-spy/` directory to `vitest-spy/`
- [ ] Rename `JestSpyService` class to `VitestSpyService`
- [ ] Rename `JestSpyFunctionStrategy` to `VitestSpyFunctionStrategy`
- [ ] Rename `JestSpyClassFunctionStrategy` to `VitestSpyClassFunctionStrategy`
- [ ] Update all filenames to use vitest prefix
- [ ] Update all imports and references
- [ ] Typecheck passes
- [ ] Tests pass

---

### US-006: Rename MockerJest strategies to MockerVitest
**Description:** As a developer, I want the mocker strategies to use Vitest naming for consistency.

**Acceptance Criteria:**
- [ ] Rename `MockerJestFunctionStrategy` to `MockerVitestFunctionStrategy`
- [ ] Rename `MockerJestClassStrategy` to `MockerVitestClassStrategy`
- [ ] Rename `MockerJestObjectStrategy` to `MockerVitestObjectStrategy`
- [ ] Update corresponding filenames
- [ ] Update contract files
- [ ] Update all imports and references
- [ ] Typecheck passes
- [ ] Tests pass

---

### US-007: Update exports in index.ts
**Description:** As a developer, I want the public API exports to reflect the new Vitest naming.

**Acceptance Criteria:**
- [ ] Update all exports in `src/index.ts` to use new class/file names
- [ ] Ensure public API is consistent
- [ ] Typecheck passes
- [ ] Tests pass

---

### US-008: Remove any Jest dependencies from package.json
**Description:** As a developer, I want to ensure no Jest packages remain as dependencies.

**Acceptance Criteria:**
- [ ] Remove any `jest`, `@types/jest`, or jest-related packages from dependencies
- [ ] Remove any `@jest/*` packages if present
- [ ] Run `npm install` to update lockfile
- [ ] Typecheck passes
- [ ] Tests pass

---

### US-009: Run full test suite and fix any failures
**Description:** As a developer, I want to verify all tests pass after the migration.

**Acceptance Criteria:**
- [ ] Run `npm run test:unit` - all tests pass
- [ ] Run `npm run test:int` - all tests pass
- [ ] Run `npm run test:e2e` - all tests pass (or skip if not applicable)
- [ ] Run `npm run build` - build succeeds
- [ ] Run `npm run lint` - no linting errors
- [ ] Typecheck passes

## Non-Goals

- No changes to the actual testing logic or contract framework behavior
- No changes to the source code under `src/` except for renaming Jest references
- No changes to the test framework (already using Vitest)
- No breaking changes to the public API (maintain exports if needed)
- No dramatic refactoring of the codebase architecture

## Technical Considerations

- The package uses TypeScript with path aliases (`#src`)
- Dual output: ESM (`dist/`) and CommonJS (`lib/`)
- Uses strategy pattern extensively - renaming should follow existing patterns
- Contract files (`*.contract.ts`) also need updates
- May need to add type aliases for backward compatibility if classes are exported publicly
